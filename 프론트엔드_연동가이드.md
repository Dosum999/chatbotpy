# ğŸ”— í”„ë¡ íŠ¸ì—”ë“œ ì—°ë™ ê°€ì´ë“œ

## ğŸ“‹ í”„ë¡œì íŠ¸ ì •ë³´
- **ë°±ì—”ë“œ ì„œë¹„ìŠ¤**: ì½”ë””ë„¤ì´í„° ì¶”ì²œ RAG AI ì±—ë´‡
- **ê¸°ìˆ ìŠ¤íƒ**: FastAPI + Google Gemini AI + RAG
- **ì„œë²„ í¬íŠ¸**: 8000-8009 (ìë™ íƒì§€)
- **ê¸°ë³¸ URL**: `http://localhost:8000`

---

## ğŸš¨ ì¤‘ìš”í•œ ì—°ë™ ì£¼ì˜ì‚¬í•­

### 1. **ì„œë²„ í¬íŠ¸ ìë™ íƒì§€**
```javascript
// âŒ ì˜ëª»ëœ ë°©ë²•: ê³ ì • í¬íŠ¸ ì‚¬ìš©
const API_BASE_URL = "http://localhost:8000";

// âœ… ì˜¬ë°”ë¥¸ ë°©ë²•: ë™ì  í¬íŠ¸ í™•ì¸
const checkServerPort = async () => {
  for (let port = 8000; port <= 8009; port++) {
    try {
      const response = await fetch(`http://localhost:${port}/health`);
      if (response.ok) {
        return `http://localhost:${port}`;
      }
    } catch (error) {
      continue;
    }
  }
  throw new Error('ì„œë²„ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
};
```

### 2. **í•„ìˆ˜ í™˜ê²½ë³€ìˆ˜ í™•ì¸**
ë°±ì—”ë“œ ì‹¤í–‰ ì „ ë°˜ë“œì‹œ í™•ì¸:
```bash
# .env íŒŒì¼ í•„ìˆ˜ ì„¤ì •
GOOGLE_API_KEY=your_google_ai_api_key
DB_HOST=localhost
DB_PORT=3306
DB_NAME=carelink
DB_USER=root
DB_PASSWORD=mysql
```

### 3. **CORS ì •ì±…**
í˜„ì¬ ëª¨ë“  ë„ë©”ì¸ í—ˆìš© ì„¤ì •:
```python
# ë°±ì—”ë“œ CORS ì„¤ì •
allow_origins=["*"]  # ê°œë°œìš©, ìš´ì˜ì‹œ ìˆ˜ì • í•„ìš”
allow_methods=["*"]
allow_headers=["*"]
```

---

## ğŸ”Œ API ì—°ë™ ë°©ë²•

### 1. **ê¸°ë³¸ ì±„íŒ… API** (`POST /chat`)

```javascript
const sendMessage = async (message) => {
  try {
    const response = await fetch(`${API_BASE_URL}/chat`, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify({
        message: message
      })
    });

    if (!response.ok) {
      throw new Error(`HTTP error! status: ${response.status}`);
    }

    const data = await response.json();
    return data;
  } catch (error) {
    console.error('ì±„íŒ… API ì˜¤ë¥˜:', error);
    throw error;
  }
};

// ì‚¬ìš© ì˜ˆì‹œ
sendMessage("ì„œìš¸ ì§€ì—­ ì—¬ì„± ì½”ë””ë„¤ì´í„° ì¶”ì²œí•´ì£¼ì„¸ìš”")
  .then(result => {
    console.log('AI ì‘ë‹µ:', result.response);
    console.log('ì¶”ì²œ ì½”ë””ë„¤ì´í„°:', result.recommendations);
  });
```

### 2. **ìŒì„± ì±„íŒ… API** (`POST /voice-chat`)

```javascript
const sendVoiceMessage = async (audioBlob) => {
  const reader = new FileReader();
  
  return new Promise((resolve, reject) => {
    reader.onload = async () => {
      const base64Audio = reader.result.split(',')[1]; // Base64 ë°ì´í„°ë§Œ ì¶”ì¶œ
      
      try {
        const response = await fetch(`${API_BASE_URL}/voice-chat`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({
            audio_data: base64Audio
          })
        });

        if (!response.ok) {
          throw new Error(`HTTP error! status: ${response.status}`);
        }

        const data = await response.json();
        resolve(data);
      } catch (error) {
        reject(error);
      }
    };
    
    reader.readAsDataURL(audioBlob);
  });
};
```

### 3. **ì„œë²„ ìƒíƒœ í™•ì¸** (`GET /health`)

```javascript
const checkServerHealth = async () => {
  try {
    const response = await fetch(`${API_BASE_URL}/health`);
    const health = await response.json();
    
    console.log('ì„œë²„ ìƒíƒœ:', health.status);
    console.log('ë¡œë“œëœ ì½”ë””ë„¤ì´í„°:', health.coordinators_loaded);
    console.log('ë²¡í„°ìŠ¤í† ì–´ ì¤€ë¹„:', health.vectorstore_ready);
    
    return health;
  } catch (error) {
    console.error('í—¬ìŠ¤ì²´í¬ ì‹¤íŒ¨:', error);
    return null;
  }
};
```

---

## ğŸ“ ì‘ë‹µ ë°ì´í„° ì²˜ë¦¬

### 1. **ì±„íŒ… ì‘ë‹µ êµ¬ì¡°**
```javascript
const processChatResponse = (data) => {
  const {
    response,           // AI ì‘ë‹µ í…ìŠ¤íŠ¸
    response_type,      // "recommendation", "redirect", "error"
    recommendations,    // ì¶”ì²œ ì½”ë””ë„¤ì´í„° ë°°ì—´
    processing_time,    // ì²˜ë¦¬ ì‹œê°„
    timestamp          // ì‘ë‹µ ì‹œê°„
  } = data;

  switch(response_type) {
    case 'recommendation':
      // ì½”ë””ë„¤ì´í„° ì¶”ì²œ ì‘ë‹µ ì²˜ë¦¬
      displayRecommendations(recommendations);
      break;
    case 'redirect':
      // ê´€ë ¨ ì—†ëŠ” ì§ˆë¬¸ ìœ ë„ ì‘ë‹µ
      showRedirectMessage(response);
      break;
    case 'error':
      // ì—ëŸ¬ ì²˜ë¦¬
      showErrorMessage(response);
      break;
  }
};
```

### 2. **ì¶”ì²œ ì½”ë””ë„¤ì´í„° ë°ì´í„° êµ¬ì¡°**
```javascript
const displayRecommendation = (coordinator) => {
  const {
    coordinator_id,     // ì½”ë””ë„¤ì´í„° ID
    name,              // ì´ë¦„
    gender,            // ì„±ë³„ ("FEMALE", "MALE")
    age,               // ë‚˜ì´
    address,           // ê±°ì£¼ì§€ì—­
    care_index,        // ëŒë´„ì§€ìˆ˜ (0-10)
    phone,             // ì—°ë½ì²˜
    regions,           // í™œë™ì§€ì—­
    certifications,    // ìê²©ì¦
    experiences,       // ê²½ë ¥ì‚¬í•­
    languages          // ì‚¬ìš©ì–¸ì–´
  } = coordinator;

  // ì„±ë³„ í•œêµ­ì–´ ë³€í™˜
  const genderKr = gender === 'FEMALE' ? 'ì—¬ì„±' : 'ë‚¨ì„±';
  
  // UIì— í‘œì‹œ
  return `
    <div class="coordinator-card">
      <h3>${name} ì½”ë””ë„¤ì´í„°</h3>
      <p>ê¸°ë³¸ì •ë³´: ${genderKr}, ${age}ì„¸</p>
      <p>ëŒë´„ì§€ìˆ˜: ${care_index}ì </p>
      <p>ì§€ì—­: ${address}</p>
      <p>ì—°ë½ì²˜: ${phone}</p>
    </div>
  `;
};
```

---

## âš ï¸ ì—ëŸ¬ ì²˜ë¦¬

### 1. **ë„¤íŠ¸ì›Œí¬ ì—ëŸ¬ ì²˜ë¦¬**
```javascript
const handleApiError = (error, endpoint) => {
  if (error.name === 'TypeError' && error.message.includes('fetch')) {
    return {
      message: 'ì„œë²„ì— ì—°ê²°í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ë°±ì—”ë“œ ì„œë²„ê°€ ì‹¤í–‰ ì¤‘ì¸ì§€ í™•ì¸í•˜ì„¸ìš”.',
      type: 'network_error',
      action: 'check_server'
    };
  }
  
  if (error.message.includes('CORS')) {
    return {
      message: 'CORS ì •ì±… ìœ„ë°˜. ì„œë²„ ì„¤ì •ì„ í™•ì¸í•˜ì„¸ìš”.',
      type: 'cors_error', 
      action: 'check_cors'
    };
  }
  
  return {
    message: `API í˜¸ì¶œ ì‹¤íŒ¨: ${error.message}`,
    type: 'api_error',
    action: 'retry'
  };
};
```

### 2. **ì‘ë‹µ ìƒíƒœ ì½”ë“œ ì²˜ë¦¬**
```javascript
const handleHttpStatus = (response) => {
  switch(response.status) {
    case 200:
      return 'success';
    case 400:
      throw new Error('ì˜ëª»ëœ ìš”ì²­ì…ë‹ˆë‹¤. ì…ë ¥ ë°ì´í„°ë¥¼ í™•ì¸í•˜ì„¸ìš”.');
    case 500:
      throw new Error('ì„œë²„ ë‚´ë¶€ ì˜¤ë¥˜ì…ë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•˜ì„¸ìš”.');
    case 503:
      throw new Error('ì„œë¹„ìŠ¤ ì´ìš© ë¶ˆê°€. ì„œë²„ê°€ ê³¼ë¶€í•˜ ìƒíƒœì…ë‹ˆë‹¤.');
    default:
      throw new Error(`HTTP ${response.status}: ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜`);
  }
};
```

---

## ğŸµ ìŒì„± ê¸°ëŠ¥ ì—°ë™

### 1. **ìŒì„± ë…¹ìŒ**
```javascript
let mediaRecorder;
let audioChunks = [];

const startRecording = async () => {
  try {
    const stream = await navigator.mediaDevices.getUserMedia({ 
      audio: {
        sampleRate: 16000,
        channelCount: 1,
        echoCancellation: true,
        noiseSuppression: true
      }
    });
    
    mediaRecorder = new MediaRecorder(stream, {
      mimeType: 'audio/webm;codecs=opus'
    });
    
    audioChunks = [];
    
    mediaRecorder.ondataavailable = event => {
      audioChunks.push(event.data);
    };
    
    mediaRecorder.onstop = () => {
      const audioBlob = new Blob(audioChunks, { type: 'audio/webm' });
      sendVoiceMessage(audioBlob);
    };
    
    mediaRecorder.start();
  } catch (error) {
    console.error('ìŒì„± ë…¹ìŒ ì‹œì‘ ì‹¤íŒ¨:', error);
  }
};

const stopRecording = () => {
  if (mediaRecorder && mediaRecorder.state === 'recording') {
    mediaRecorder.stop();
    mediaRecorder.stream.getTracks().forEach(track => track.stop());
  }
};
```

### 2. **ìŒì„± ê¶Œí•œ ì²´í¬**
```javascript
const checkMicrophonePermission = async () => {
  try {
    const permission = await navigator.permissions.query({ name: 'microphone' });
    
    switch(permission.state) {
      case 'granted':
        return true;
      case 'denied':
        alert('ë§ˆì´í¬ ê¶Œí•œì´ ê±°ë¶€ë˜ì—ˆìŠµë‹ˆë‹¤. ë¸Œë¼ìš°ì € ì„¤ì •ì—ì„œ ë§ˆì´í¬ ê¶Œí•œì„ í—ˆìš©í•´ì£¼ì„¸ìš”.');
        return false;
      case 'prompt':
        // ê¶Œí•œ ìš”ì²­
        const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
        stream.getTracks().forEach(track => track.stop());
        return true;
    }
  } catch (error) {
    console.error('ë§ˆì´í¬ ê¶Œí•œ í™•ì¸ ì‹¤íŒ¨:', error);
    return false;
  }
};
```

---

## ğŸ”„ ì¬ì—°ê²° ë¡œì§

### 1. **ìë™ ì¬ì—°ê²°**
```javascript
class ApiClient {
  constructor(baseUrl) {
    this.baseUrl = baseUrl;
    this.maxRetries = 3;
    this.retryDelay = 1000;
  }

  async requestWithRetry(endpoint, options = {}) {
    for (let attempt = 1; attempt <= this.maxRetries; attempt++) {
      try {
        const response = await fetch(`${this.baseUrl}${endpoint}`, options);
        
        if (!response.ok) {
          throw new Error(`HTTP ${response.status}`);
        }
        
        return await response.json();
      } catch (error) {
        if (attempt === this.maxRetries) {
          throw error;
        }
        
        console.warn(`API í˜¸ì¶œ ì‹¤íŒ¨ (${attempt}/${this.maxRetries}):`, error.message);
        await this.delay(this.retryDelay * attempt);
      }
    }
  }

  delay(ms) {
    return new Promise(resolve => setTimeout(resolve, ms));
  }
}
```

### 2. **ì„œë²„ ìƒíƒœ ëª¨ë‹ˆí„°ë§**
```javascript
class ServerMonitor {
  constructor(apiClient) {
    this.apiClient = apiClient;
    this.isHealthy = false;
    this.healthCheckInterval = null;
  }

  startMonitoring() {
    this.healthCheckInterval = setInterval(async () => {
      try {
        const health = await this.apiClient.requestWithRetry('/health');
        this.isHealthy = health.status === 'healthy';
        
        if (!this.isHealthy) {
          this.onServerUnhealthy();
        }
      } catch (error) {
        this.isHealthy = false;
        this.onServerDown();
      }
    }, 30000); // 30ì´ˆë§ˆë‹¤ ì²´í¬
  }

  onServerUnhealthy() {
    console.warn('ì„œë²„ê°€ ë¶ˆì•ˆì •í•œ ìƒíƒœì…ë‹ˆë‹¤.');
  }

  onServerDown() {
    console.error('ì„œë²„ì™€ ì—°ê²°ì´ ëŠì–´ì¡ŒìŠµë‹ˆë‹¤.');
  }

  stopMonitoring() {
    if (this.healthCheckInterval) {
      clearInterval(this.healthCheckInterval);
    }
  }
}
```

---

## ğŸš€ ìµœì í™” íŒ

### 1. **ìš”ì²­ ìµœì í™”**
```javascript
// ë””ë°”ìš´ì‹±ìœ¼ë¡œ ê³¼ë„í•œ ìš”ì²­ ë°©ì§€
let debounceTimer;
const debouncedSendMessage = (message, delay = 500) => {
  clearTimeout(debounceTimer);
  debounceTimer = setTimeout(() => {
    sendMessage(message);
  }, delay);
};

// ìš”ì²­ ìºì‹±
const responseCache = new Map();
const cachedRequest = async (message) => {
  const cacheKey = message.toLowerCase().trim();
  
  if (responseCache.has(cacheKey)) {
    return responseCache.get(cacheKey);
  }
  
  const response = await sendMessage(message);
  responseCache.set(cacheKey, response);
  
  // 5ë¶„ í›„ ìºì‹œ ì œê±°
  setTimeout(() => {
    responseCache.delete(cacheKey);
  }, 300000);
  
  return response;
};
```

### 2. **ë¡œë”© ìƒíƒœ ê´€ë¦¬**
```javascript
const LoadingManager = {
  show() {
    document.getElementById('loading').style.display = 'block';
  },
  
  hide() {
    document.getElementById('loading').style.display = 'none';
  },
  
  async withLoading(asyncFunction) {
    this.show();
    try {
      const result = await asyncFunction();
      return result;
    } finally {
      this.hide();
    }
  }
};

// ì‚¬ìš© ì˜ˆì‹œ
LoadingManager.withLoading(() => sendMessage("ì½”ë””ë„¤ì´í„° ì¶”ì²œí•´ì£¼ì„¸ìš”"));
```

---

## ğŸ› ï¸ ê°œë°œ í™˜ê²½ ì„¤ì •

### 1. **ë¡œì»¬ ê°œë°œ ì²´í¬ë¦¬ìŠ¤íŠ¸**
- [ ] Python 3.8+ ì„¤ì¹˜
- [ ] ê°€ìƒí™˜ê²½ ìƒì„± ë° í™œì„±í™”
- [ ] `pip install -r requirements.txt`
- [ ] `.env` íŒŒì¼ ì„¤ì •
- [ ] MySQL ì„œë²„ ì‹¤í–‰
- [ ] `python chatbot.py` ì‹¤í–‰
- [ ] ë¸Œë¼ìš°ì €ì—ì„œ `http://localhost:8000/health` ì ‘ì† í™•ì¸

### 2. **í™˜ê²½ë³„ ì„¤ì •**
```javascript
const config = {
  development: {
    API_BASE_URL: 'http://localhost:8000',
    DEBUG: true,
    RETRY_COUNT: 3
  },
  production: {
    API_BASE_URL: 'https://your-api-domain.com',
    DEBUG: false,
    RETRY_COUNT: 5
  }
};

const currentConfig = config[process.env.NODE_ENV || 'development'];
```

---

## ğŸ“± ë°˜ì‘í˜• ê³ ë ¤ì‚¬í•­

### 1. **ëª¨ë°”ì¼ ìŒì„± ë…¹ìŒ**
```javascript
const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);

if (isMobile) {
  // ëª¨ë°”ì¼ì—ì„œëŠ” í„°ì¹˜ ì´ë²¤íŠ¸ë¡œ ë…¹ìŒ ì‹œì‘/ì¢…ë£Œ
  document.getElementById('recordBtn').addEventListener('touchstart', startRecording);
  document.getElementById('recordBtn').addEventListener('touchend', stopRecording);
} else {
  // ë°ìŠ¤í¬í†±ì—ì„œëŠ” í´ë¦­ ì´ë²¤íŠ¸
  document.getElementById('recordBtn').addEventListener('mousedown', startRecording);
  document.getElementById('recordBtn').addEventListener('mouseup', stopRecording);
}
```

### 2. **í™”ë©´ í¬ê¸°ë³„ UI ì¡°ì •**
```css
/* ì¶”ì²œ ì½”ë””ë„¤ì´í„° ì¹´ë“œ ë°˜ì‘í˜• */
.coordinator-card {
  width: 100%;
  margin-bottom: 16px;
}

@media (min-width: 768px) {
  .coordinator-card {
    width: calc(50% - 8px);
    display: inline-block;
    margin-right: 16px;
  }
}

@media (min-width: 1024px) {
  .coordinator-card {
    width: calc(33.333% - 11px);
  }
}
```

---

## ğŸ” íŠ¸ëŸ¬ë¸”ìŠˆíŒ…

### 1. **ìì£¼ ë°œìƒí•˜ëŠ” ë¬¸ì œ**

**ë¬¸ì œ**: "ì„œë²„ì— ì—°ê²°í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤"
```javascript
// í•´ê²° ë°©ë²•
const troubleshootConnection = async () => {
  console.log('1. ë°±ì—”ë“œ ì„œë²„ ì‹¤í–‰ ìƒíƒœ í™•ì¸...');
  
  // ë‹¤ì–‘í•œ í¬íŠ¸ í™•ì¸
  for (let port = 8000; port <= 8009; port++) {
    try {
      const response = await fetch(`http://localhost:${port}/health`, {
        method: 'GET',
        mode: 'cors'
      });
      
      if (response.ok) {
        console.log(`âœ… ì„œë²„ ë°œê²¬: http://localhost:${port}`);
        return `http://localhost:${port}`;
      }
    } catch (error) {
      console.log(`âŒ í¬íŠ¸ ${port}: ì—°ê²° ì‹¤íŒ¨`);
    }
  }
  
  console.log('ğŸš¨ í•´ê²° ë°©ë²•:');
  console.log('1. í„°ë¯¸ë„ì—ì„œ "python chatbot.py" ì‹¤í–‰');
  console.log('2. .env íŒŒì¼ì˜ GOOGLE_API_KEY í™•ì¸');
  console.log('3. ë°©í™”ë²½ ì„¤ì • í™•ì¸');
};
```

**ë¬¸ì œ**: "ìŒì„± ì¸ì‹ì´ ì•ˆ ë©ë‹ˆë‹¤"
```javascript
const troubleshootVoice = async () => {
  // ë§ˆì´í¬ ê¶Œí•œ í™•ì¸
  const hasPermission = await checkMicrophonePermission();
  if (!hasPermission) {
    console.log('âŒ ë§ˆì´í¬ ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤.');
    return;
  }
  
  // ë¸Œë¼ìš°ì € ì§€ì› í™•ì¸
  if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
    console.log('âŒ ë¸Œë¼ìš°ì €ê°€ ìŒì„± ë…¹ìŒì„ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.');
    return;
  }
  
  // HTTPS í™•ì¸ (Chrome ë“±ì—ì„œ í•„ìš”)
  if (location.protocol !== 'https:' && location.hostname !== 'localhost') {
    console.log('âŒ HTTPS í™˜ê²½ì—ì„œë§Œ ìŒì„± ë…¹ìŒì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.');
    return;
  }
  
  console.log('âœ… ìŒì„± ê¸°ëŠ¥ í™˜ê²½ì´ ì •ìƒì…ë‹ˆë‹¤.');
};
```

### 2. **ì„±ëŠ¥ ë¬¸ì œ í•´ê²°**
```javascript
const optimizePerformance = () => {
  // 1. ë¶ˆí•„ìš”í•œ API í˜¸ì¶œ ì œê±°
  const messageHistory = [];
  const isDuplicateMessage = (message) => {
    const recent = messageHistory.slice(-3); // ìµœê·¼ 3ê°œë§Œ í™•ì¸
    return recent.includes(message);
  };

  // 2. ì‘ë‹µ í¬ê¸° ìµœì í™”
  const optimizeResponse = (data) => {
    if (data.recommendations) {
      // í•„ìš”í•œ í•„ë“œë§Œ ìœ ì§€
      data.recommendations = data.recommendations.map(coord => ({
        name: coord.name,
        gender: coord.gender,
        age: coord.age,
        care_index: coord.care_index,
        phone: coord.phone,
        address: coord.address
      }));
    }
    return data;
  };

  // 3. ë©”ëª¨ë¦¬ ì •ë¦¬
  const cleanupResources = () => {
    // í° ì‘ë‹µ ë°ì´í„° ì •ë¦¬
    if (responseCache.size > 50) {
      const keys = Array.from(responseCache.keys());
      const oldKeys = keys.slice(0, 25);
      oldKeys.forEach(key => responseCache.delete(key));
    }
  };
};
```

---

ì´ ê°€ì´ë“œë¥¼ ì°¸ê³ í•˜ì—¬ ì•ˆì •ì ì´ê³  íš¨ìœ¨ì ì¸ í”„ë¡ íŠ¸ì—”ë“œ ì—°ë™ì„ êµ¬í˜„í•˜ì„¸ìš”. ì¶”ê°€ ì§ˆë¬¸ì´ ìˆìœ¼ì‹œë©´ ë°±ì—”ë“œ ê°œë°œíŒ€ì— ë¬¸ì˜í•´ì£¼ì„¸ìš”.